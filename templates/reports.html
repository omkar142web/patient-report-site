<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="layout">
      <div class="sidebar">
        <h2>ðŸ©º Clinic</h2>
        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
      </div>

      <div class="main">
        <h1>Patient Records</h1>

        <form class="search-box" action="{{ url_for('reports') }}" method="get">
          <label for="search" class="sr-only"
            >Search patient or report name</label
          >
          <input
            id="search"
            name="search"
            placeholder="ðŸ” Search patient or report name..."
            value="{{ search }}"
          />
          <button type="submit" class="search-btn">Search</button>
        </form>

        {% if not data %}
        <div class="no-data">
          <p>No patients found.</p>
        </div>
        {% endif %} {% for patient, files in data.items() %}
        <section class="patient-section">
          <h3 class="patient-title">
            <span>ðŸ‘¤ {{ patient }}</span>
            <span class="file-count-badge">{{ files|length }} 
              {% if files|length == 1 %}file{% else %}files{% endif %}
            </span>
          </h3>

          <div class="grid">
            {% for file_obj in files %}
            <div class="card">
              <div class="file-name">{{ file_obj.name }}</div>
              <div class="file-date">Uploaded on: {{ file_obj.date }}</div>

              {% if file_obj.name.endswith(".pdf") %}
              <span class="badge pdf">PDF</span>
              <iframe
                src="{{ url_for('preview', patient=patient, filename=file_obj.name) }}"
                title="PDF preview for {{ file_obj.name }}"
              ></iframe>
              {% else %}
              <span class="badge img">IMG</span>
              <img
                src="{{ url_for('preview', patient=patient, filename=file_obj.name) }}"
                alt="Image preview for {{ file_obj.name }}"
              />
              {% endif %}

              <div class="actions">
                <a
                  href="{{ url_for('preview', patient=patient, filename=file_obj.name) }}"
                  target="_blank"
                  rel="noopener noreferrer"
                  >Open</a
                >
                <a
                  href="{{ url_for('delete_file', patient=patient, filename=file_obj.name) }}"
                  class="delete"
                  aria-label="Delete report {{ file_obj.name }}"
                  >Delete</a
                >
              </div>
            </div>
            {% endfor %}
          </div>
        </section>
        {% endfor %}
      </div>
    </div>

    <div id="toast-container"></div>
    <script src="{{ url_for('static', filename='toast.js') }}"></script>
    <script
      src="{{ url_for('static', filename='reports.js') }}"
      data-reports-url="{{ url_for('reports') }}"
    ></script>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <script>showToast("{{ message }}", "{{ category }}");</script>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </body>
</html>
